<project name="FluidEngage" default="releaseBuild" basedir=".">
    <description>
      Build a distributable package of Fluid Engage.
      
      To build a distribution, type: ant
    </description>

    <property file="build.properties"/>
    <import file="buildutils.xml"/>

    <target name="initDirs" depends="clean, init">
        <mkdir dir="${build-webapp}" />
        <mkdir dir="${build-java}" />
    </target>
    
    <target name="infusionBuild">
        <ant dir="${infusion-scripts}" target="customBuild" inheritAll="false" />
        
        <copy todir="${build-webapp}/infusion" >
            <fileset dir="${infusion-dist}">
                <exclude name="**/*.war" />
            </fileset>
        </copy>
    </target>
    
    <target name="engageClientBuild">
        <copy todir="${build-webapp}/engage-client">
            <fileset dir="${engage-client}" includes="components/**, framework/**"></fileset>
        </copy>        
    </target>
     
    <target name="engageServerBuild">
        <copy todir="${build-webapp}">
            <fileset dir="${src-webapp}">
                <include name="kettle/**" />
                <include name="engage/**" />
                <include name="artifactDemo/**" />
                <include name="browseDemo/**" />
                <include name="kettleDemo/**" />
                <include name="WEB-INF/**" />
                <exclude name="**/engage*Config.json" />
            </fileset>
        </copy>
        <copy tofile="${build-webapp}/engage/engageConfig.json" file="${src-webapp}/engage/engageStandaloneConfig.json" />
        <copy todir="${build-java}">
            <fileset dir="${src-java}"></fileset>
        </copy> 
    </target>
    
    <target name="copyToBundles">        
        <copy todir="${src-dist}">
            <fileset dir="${build}" />
        </copy>

        <copy todir="${dist}">
            <fileset dir="${build}" />
        </copy>
    </target>

    <!-- Copies the files required to build a war file -->
    <target name="copyWARFiles">        
      <copy todir="${build}/war" >
        <fileset dir="${dist}"></fileset>
        <fileset dir="${base-dir}">
            <include name="pom.xml" />
        </fileset>
      </copy>
    </target>
        
    <target name="distWAR" depends="copyWARFiles, buildWAR"></target>

    <target name="releaseBuild" depends="initDirs, infusionBuild, engageClientBuild, engageServerBuild, copyToBundles, distWAR" 
        description="Builds and packages a release bundle of Engage.">
    </target>
        
</project>
