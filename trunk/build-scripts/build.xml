<project name="FluidEngage" default="releaseBuild" basedir=".">
    <description>
      Build a distributable package of Fluid Engage.
    </description>

    <property file="build.properties"/>
        
    <!-- Target: cleanup before running - identical to Infusion ant task -->
    <target name="clean" description="Cleans up all build-related artifacts and products.">
        <delete dir="${build}" />
        <delete dir="${products}" />
    </target>
  
    <!-- Set up the build directory structure - identical to Infusion ant task -->
    <target name="init">
        <mkdir dir="${products}" />
        <mkdir dir="${build}" />
        <mkdir dir="${build-webapp}" />
        <mkdir dir="${build-webapp}/infusion" />
        <mkdir dir="${dist}" />
        <mkdir dir="${src-dist}" />
        <mkdir dir="${licenses}" />
    </target>

    <target name="infusionBuild">
        <ant dir="${infusion-scripts}" target="customBuild" inheritAll="false" />
        
        <copy todir="${build-webapp}/infusion" >
            <fileset dir="${infusion-dist}">
                <exclude name="**/*.war" />
            </fileset>
        </copy>
    </target>
    
    <target name="copyToBundles">        
        <copy todir="${src-dist}">
            <fileset dir="${build}" />
        </copy>

        <copy todir="${dist}">
            <fileset dir="${build}" />
        </copy>
    </target>

    <target name="releaseBuild" depends="clean, init, infusionBuild, copyToBundles" 
        description="Builds and packages a release bundle of Engage.">
    </target>
        
</project>
